--INSERIR DADOS
INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('004', TO_DATE('2019-01-02', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('004', '1000889', 21,10);

--EXEMPLO PARA CRIACAO E IMPLEMENTACAO DA TRIGGER
DELETE FROM TAB_FATURAMENTO;
INSERT INTO TAB_FATURAMENTO
SELECT N.DATA_VENDA,
       SUM(ITN.QUANTIDADE * ITN.PRECO) AS FATURAMENTO
FROM NOTAS N
INNER JOIN ITENS_NOTAS ITN
ON N.NUMERO = ITN.NUMERO
GROUP BY N.DATA_VENDA;


--TRIGGER
CREATE TRIGGER TG_TAB_FATURAMENTO
AFTER INSERT ON ITENS_NOTAS --SERA EXECUTADO DEPOIS DE INSERIR RM ITENS_NOTAS
BEGIN
    DELETE FROM TAB_FATURAMENTO;
    INSERT INTO TAB_FATURAMENTO
    SELECT N.DATA_VENDA,
       SUM(ITN.QUANTIDADE * ITN.PRECO) AS FATURAMENTO
    FROM NOTAS N
    INNER JOIN ITENS_NOTAS ITN
    ON N.NUMERO = ITN.NUMERO
    GROUP BY N.DATA_VENDA;
END;


--INSERIR DADOS
INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('005', TO_DATE('2019-01-03', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('005', '1000889', 12,10);
--INSERIR DADOS
INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('006', TO_DATE('2019-01-03', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('006', '1000889', 40,10);

INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('007', TO_DATE('2019-01-03', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('007', '1000889', 40,10);

INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('008', TO_DATE('2019-01-01', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('008', '1000889', 100,10);

INSERT INTO NOTAS
(NUMERO, DATA_VENDA, CPF, MATRICULA, IMPOSTO)
VALUES ('009', TO_DATE('2019-01-02', 'YYYY-MM-DD'), '1471156710','235', 0.1);
INSERT INTO ITENS_NOTAS
(NUMERO, CODIGO, QUANTIDADE, PRECO)
VALUES ('009', '1000889', 100,10);

--AGORA QUANDO INSERIR E DAR UM SELECT NA TAB_FATURAMENTO, ELA ATUALIZARA AUTOMATICAMENTE
SELECT * FROM TAB_FATURAMENTO;


COMMIT;